(function(e){function t(t){for(var a,o,s=t[0],d=t[1],l=t[2],u=0,p=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&(e[a]=d[a]);c&&c(t);while(p.length)p.shift()();return n.push.apply(n,l||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],a=!0,s=1;s<r.length;s++){var d=r[s];0!==i[d]&&(a=!1)}a&&(n.splice(t--,1),e=o(o.s=r[0]))}return e}var a={},i={app:0},n=[];function o(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=a,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(r,a,function(t){return e[t]}.bind(null,a));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],d=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var c=d;n.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"0f94":function(e,t,r){"use strict";r("8f6b")},5490:function(e,t,r){"use strict";r("a6b6")},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),i=r("ce5b"),n=r.n(i);r("bf40");a["default"].use(n.a);var o=new n.a({}),s=r("ba48"),d=r.n(s),l=r("c27a"),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Map")],1)},u=[],p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.appLoaded?e._e():r("loader",{staticStyle:{"z-index":"999"},attrs:{object:"#ffffff",color1:"#ffffff",color2:"#17fd3d",size:"5",speed:"1",bg:"#343a40",objectbg:"#999793",opacity:"80",disableScrolling:"false",name:"dots"}}),r("v-app",[r("v-system-bar",{attrs:{window:"",dark:e.appDark}},[r("v-tooltip",{staticStyle:{"z-index":"999"},attrs:{bottom:"","open-delay":"250"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,i=t.attrs;return[r("v-switch",{attrs:{dense:"",small:""},on:{change:function(t){return e.changeMapTheme()}},model:{value:e.appDark,callback:function(t){e.appDark=t},expression:"appDark"}}),r("v-icon",e._g(e._b({},"v-icon",i,!1),a),[e._v(e._s(e.appDark?"mdi-lightbulb":"mdi-lightbulb-outline"))])]}}])},[r("span",[e._v(e._s(e.appDark?"Включить светлый интерфейс":"Включить тёмный интерфейс"))])]),r("nobr",{staticStyle:{overflow:"hidden"}},[e._v(e._s(e.infoMessage))]),r("v-spacer"),r("v-tooltip",{staticStyle:{"z-index":"999"},attrs:{bottom:"","open-delay":"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,i=t.attrs;return[r("nobr",{staticStyle:{overflow:"hidden","min-width":"fit-content"}},[r("span",e._g(e._b({staticClass:"system-bar-element",staticStyle:{float:"right"}},"span",i,!1),a),[r("v-icon",[e._v("mdi-lan-connect")]),r("span",[e._v(e._s(e.statusBar.connectionSpeed))]),e._v(" мс ")],1)])]}}])},[r("span",[e._v("Время ответа от сервера. Меньше — лучше")])]),r("v-tooltip",{staticStyle:{"z-index":"999"},attrs:{bottom:"","open-delay":"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,i=t.attrs;return[r("nobr",{staticStyle:{overflow:"hidden","min-width":"fit-content"}},[r("span",e._g(e._b({staticClass:"system-bar-element",staticStyle:{float:"right"}},"span",i,!1),a),[r("v-icon",[e._v("mdi-airplane")]),r("span",[e._v(e._s(e.statusBar.totalUavs)+" ЛА ")])],1)])]}}])},[r("span",[e._v("ЛA полете в данный момент")])]),r("v-tooltip",{staticStyle:{"z-index":"999"},attrs:{bottom:"","open-delay":"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,i=t.attrs;return[r("nobr",{staticStyle:{overflow:"hidden","min-width":"fit-content"}},[r("span",e._g(e._b({staticClass:"system-bar-element",staticStyle:{float:"right"}},"span",i,!1),a),[r("v-icon",[e._v("mdi-bag-checked")]),r("span",[e._v(e._s(e.statusBar.totalOrders)+" "),e.$isMobile()?e._e():r("span",[e._v("активных заказов")])])],1)])]}}])},[r("span",[e._v("Активных заказов в данный момент")])])],1),e.$isMobile()?e._e():r("v-row",{attrs:{"no-gutters":""}},[r("v-col",{attrs:{cols:"3",id:"uavControlsDesktop"}},[r("v-card",{attrs:{id:"uavControlsDesktopCard",outlined:"",tile:"",dark:e.appDark}},[r("div",[r("v-container",[r("v-card-actions",{staticClass:"justify-center"},[r("v-btn-toggle",{staticStyle:{display:"block",margin:"auto"},attrs:{color:"primary",dense:"",outlined:e.appDark,mandatory:"",rounded:""},on:{change:function(t){e.toggleDeliveryZone(),e.resetAddOrder()}},model:{value:e.window,callback:function(t){e.window=t},expression:"window"}},[r("v-btn",[e._v(" Добавить ")]),r("v-btn",[e._v(" Отследить ")])],1)],1),r("v-window",{staticClass:"elevation-1",model:{value:e.window,callback:function(t){e.window=t},expression:"window"}},[r("v-window-item",[r("v-card",{attrs:{flat:""}},[r("v-card-title",[e._v("Создание заказа")]),r("v-card-text",[e.UI.addOrder.error?r("v-alert",{attrs:{border:"left","colored-border":"",type:"error",elevation:"2",icon:"mdi-alert-circle-outline",prominent:""}},[r("div",{staticClass:"text-h6"},[e._v("Ошибка при создании заказа")]),r("div",{staticClass:"text-body-2"},[e._v("Проверьте нахождение точек в зонах доставки")])]):e._e(),r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("transition",{attrs:{name:"fade"}},[[e.UI.addOrder.arePointsAdded?e._e():r("v-btn",{attrs:{rounded:"",outlined:"",block:""},on:{click:e.addOrderMarkers}},[e.UI.addOrder.processing?r("v-icon",{attrs:{dense:""}},[e._v("mdi-map-marker-outline")]):r("v-icon",{attrs:{dense:""}},[e._v("mdi-plus")]),e._v("  "+e._s(e.UI.addOrder.locBtnText)+" ")],1)]],2),r("transition",{attrs:{name:"fade"}},[e.UI.addOrder.processing?r("div",{staticClass:"pt-2 text-caption"},[e._v(" на карте, используя правую кнопку мыши (ПКМ) ")]):e._e()]),r("v-text-field",{ref:"addOrder_Weight",staticClass:"mt-5",attrs:{hint:"Укажите массу груза",counter:10,color:"[{ 'white': appDark }, 'black']",outlined:"",dense:"",label:"Масса",suffix:"кг",required:""},model:{value:e.UI.addOrder.orderWeight,callback:function(t){e.$set(e.UI.addOrder,"orderWeight",t)},expression:"UI.addOrder.orderWeight"}}),r("div",{staticClass:"text-right"},[r("v-btn",{staticClass:"mt-4",attrs:{disabled:!e.valid,color:"[{ 'white': appDark }, 'black']",loading:e.UI.addOrder.sending,rounded:"",outlined:""},on:{click:function(t){return e.sendNewOrder()}}},[e._v(" Создать ")])],1)],1)],1)],1)],1),r("v-window-item",[r("transition",{attrs:{name:"fade"}},[r("v-card",{attrs:{flat:""}},[r("v-card-title",[e._v("Отслеживание заказа")]),r("v-card-text",[r("v-form",{ref:"form",attrs:{"lazy-validation":""}},[r("v-text-field",{attrs:{counter:10,outlined:"",dense:"",color:"[{ 'white': appDark }, 'black']",label:"Номер заказа",required:"","append-icon":"mdi-magnify"},on:{"click:append":function(t){return e.sendTrackOrder(e.UI.trackOrder.input_id)}},model:{value:e.UI.trackOrder.input_id,callback:function(t){e.$set(e.UI.trackOrder,"input_id",t)},expression:"UI.trackOrder.input_id"}})],1)],1),r("v-card-text",[r("UI_Route",{attrs:{wrong_id:e.UI.track.result,appDark:e.appDark,map:e.map,order_id:e.UI.addOrder.orderInfo.order_id,weight:e.UI.addOrder.orderInfo.weight,arrival_lat:e.UI.addOrder.orderInfo.first_lat,arrival_lon:e.UI.addOrder.orderInfo.first_lon,route:e.UI.addOrder.orderInfo.route}})],1)],1)],1)],1)],1)],1)],1)]),e.UI.uavInfo.show?r("v-card",{attrs:{id:"uavInfoDesktopCard",outlined:"",tile:"",dark:e.appDark}},[r("v-container",[r("v-card",[r("v-card-title",{staticClass:"mt-8"},[r("v-avatar",{attrs:{size:"56"}},[r("img",{attrs:{src:e.UI.uavInfo.image}})]),r("div",{staticClass:"ml-3"},[e._v(" ЛА #"+e._s(e.UI.uavInfo.id)+" "),r("div",{staticClass:"text-body-2"},[e._v(e._s(e.UI.uavInfo.type))])])],1),r("v-simple-table",{attrs:{dense:""},scopedSlots:e._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-left"},[e._v("Заказы на борту")])])]),r("tbody",e._l(e.UI.uavInfo.ordersOnboard,(function(t){return r("tr",{key:t},[r("td",[r("span",{staticClass:"text-body-1"},[e._v(e._s(t))])]),r("td",[r("v-btn",{staticClass:"my-2",staticStyle:{display:"block","margin-right":"0","margin-left":"auto"},attrs:{fab:"","x-small":"",color:"primary"},on:{click:function(r){return e.sendTrackOrder(t)}}},[r("v-icon",{attrs:{dark:""}},[e._v(" mdi-map-marker-question ")])],1)],1)])})),0)]},proxy:!0}],null,!1,571860038)})],1)],1)],1):e._e()],1),r("v-col",{attrs:{cols:"9"}},[r("v-card",{staticStyle:{border:"none"},attrs:{outlined:"",tile:"",dark:e.appDark}},[r("div",{staticClass:"uavKartaContainerDesktop"},[r("div",{ref:"uavKartaRef",style:[e.return_is_UI_AddOrder_Proc()?{cursor:"crosshair"}:""],attrs:{id:"uavKarta"}})])])],1)],1),e.$isMobile()?r("div",{staticClass:"uavKartaContainerMobile"},[r("div",{ref:"uavKartaRef",attrs:{id:"uavKarta"}})]):e._e()],1)],1)},h=[],f=(r("d81d"),r("d3b7"),r("a9e3"),r("159b"),r("b680"),r("c96a"),r("18a5"),r("6cc5"),r("e11e")),v=r.n(f),m=(r("a8b7"),r("180e"),r("bc3a")),I=r.n(m),g=(r("970a"),r("7aaa")),k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return void 0!==e.wrong_id?r("div",[e.wrong_id?e.wrong_id?r("div",[r("v-card",[r("v-card-title",{staticClass:"subheading font-weight-bold"},[e._v("Заказ #"+e._s(e.order_id))]),r("v-divider"),r("v-list",{attrs:{dense:""}},[r("v-list-item",[r("v-list-item-content",{staticClass:"text-body-1"},[e._v("Масса груза")]),r("v-list-item-content",{staticClass:"align-end text-body-1"},[e._v(e._s(e.weight)+" кг")])],1)],1)],1),r("v-timeline",{attrs:{id:"uavRoute","align-top":"",dense:""}},e._l(e.route,(function(t){return r("div",{key:t},[t===e.route[0]?r("v-timeline-item",{attrs:{color:"primary",dense:""},scopedSlots:e._u([{key:"icon",fn:function(){return[r("v-icon",{attrs:{dense:"",color:"white"}},[e._v("mdi-airplane-takeoff")])]},proxy:!0}],null,!0)},[r("div",{staticClass:"text-h6"},[r("nobr",[e._v("Хаб "+e._s(t.HubID))])],1),r("nobr",{staticClass:"text-subtitle-2"},[r("v-icon",{attrs:{dense:"",dark:e.appDark}},[e._v("mdi-map-marker-outline")]),r("a",{on:{click:function(r){e.focusAtHub(180*t.lan_pos/e.Uav_PI,180*t.lon_pos/e.Uav_PI)}}},[e._v(" "+e._s((180*t.lan_pos/e.Uav_PI).toFixed(6))+", "+e._s((180*t.lon_pos/e.Uav_PI).toFixed(6)))])],1)],1):t===e.route[e.route.length-1]?r("v-timeline-item",{attrs:{color:"white",dense:""},scopedSlots:e._u([{key:"icon",fn:function(){return[r("v-icon",{attrs:{dense:"",color:"black"}},[e._v("mdi-airplane-landing")])]},proxy:!0}],null,!0)},[r("div",{staticClass:"text-h6"},[r("nobr",[e._v("Хаб #"+e._s(t.HubID))])],1),r("nobr",{staticClass:"text-subtitle-2"},[r("v-icon",{attrs:{dense:"",dark:""}},[e._v("mdi-map-marker-outline")]),r("a",{staticStyle:{"[{ 'white'":"appDark }, 'black']"},on:{click:function(r){e.focusAtHub(180*t.lan_pos/e.Uav_PI,180*t.lon_pos/e.Uav_PI)}}},[e._v(" "+e._s((180*t.lan_pos/e.Uav_PI).toFixed(6))+", "+e._s((180*t.lon_pos/e.Uav_PI).toFixed(6)))])],1)],1):r("v-timeline-item",{attrs:{color:"grey darken-2",dense:"",small:""}},[r("div",{staticClass:"text-bold"},[r("nobr",[e._v("Хаб "+e._s(t.HubID))])],1),r("nobr",{staticClass:"text-subtitle-2"},[r("v-icon",{attrs:{dense:"",dark:e.appDark}},[e._v("mdi-map-marker-outline")]),r("a",{staticStyle:{"[{ 'white'":"appDark }, 'black']"},on:{click:function(r){e.focusAtHub(180*t.lan_pos/e.Uav_PI,180*t.lon_pos/e.Uav_PI)}}},[e._v(" "+e._s((180*t.lan_pos/e.Uav_PI).toFixed(6))+", "+e._s((180*t.lon_pos/e.Uav_PI).toFixed(6)))])],1)],1)],1)})),0)],1):e._e():r("v-alert",{attrs:{border:"left","colored-border":"",type:"warning",elevation:"2",icon:"mdi-alert-circle-outline"}},[r("div",{staticClass:"text-body-1"},[e._v("Заказа с таким номером не существует")])])],1):e._e()},U=[],b={props:{wrong_id:Boolean,appDark:Boolean,departure_lat:Number,departure_lon:Number,arrival_lat:Number,arrival_lon:Number,weight:String,order_id:String,route:[],map:{}},data:function(){return{Uav_PI:3.141592,Hub_CircleMarker:Object}},methods:{focusAtHub:function(e,t){this.map.flyTo(new v.a.LatLng(e,t),10)}}},y=b,_=(r("0f94"),r("2877")),O=Object(_["a"])(y,k,U,!1,null,null,null),w=O.exports,x={components:{UI_Route:w},data:function(){return{appLoaded:!1,appDark:!0,connectionSpeed:"",statusBar:{connectionSpeed:"—",totalUavs:"—",totalOrders:"—"},totalStats:{aircraftsInFlight:0,totalOrders:0},length:2,window:1,UI:{uavInfo:{type:"",id:"",image:"",show:!0,ordersOnboard:[]},watchOrder:{success:!1},addOrder:{error:!1,showMarkers:!1,processing:!1,locBtnText:"Откуда, куда",locBtnTextDefault:"Откуда, куда",sending:!1,arePointsAdded:!1,firstProcessing:!1,firstLatLng:null,firstMarker:null,firstIcon:v.a.icon({iconUrl:"marker-a.png",shadowUrl:"marker-a.png",iconSize:[30,30],shadowSize:[30,30],iconAnchor:[15,15],shadowAnchor:[15,15],popupAnchor:[15,15]}),secondProcessing:!1,secondLatLng:null,secondMarker:null,secondIcon:v.a.icon({iconUrl:"marker-b.png",shadowUrl:"marker-b.png",iconSize:[30,30],shadowSize:[30,30],iconAnchor:[15,15],shadowAnchor:[15,15],popupAnchor:[15,15]}),orderWeight:null,orderInfo:{}},trackOrder:{input_id:null},track:{RoutePolyline:Object,RoutePoints:[],PreRoutePolyline:Object,PreRoutePoints:[],ApRoutePolyline:Object,ApRoutePoints:[],result:void 0}},infoMessage:"",map:{},mapTile:{},mapFilter:{light:["bright:80%"],dark:["invert:100%","grayscale:65%","bright:80%","contrast:97%","hue:200deg","saturate:150%"]},aircraftFromApi:{raw:null},HubsFromApi:{small:[],medium:[],large:[]},MarkersArrays:[[],[],[],[]],MarkersArrays_len:[3e3,3e3,2e3,100],initPos:1e3,uavControlsUI:{createOrder:{isOpen:!1}},apiServer:{url:"http://roknyazev.engineer/"},postHeaders:{"Content-Type":"application/json","Content-Length":null,Accept:"*/*","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive"},renderer:null,project:null,container:null,hub_renderer:null,hub_project:null,hub_container:null,DEV_autoRenderUavs:!1,prev_counters:[0,0,0,0],interval:35,getScale:null,target_scale:1/7,selected_id:0,dist20kmProject:null,globalCircle:null}},mounted:function(){var e=this,t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(t,"px")),window.addEventListener("resize",(function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))})),this.map=v.a.map(this.$refs["uavKartaRef"],{preferCanvas:!0,zoomControl:!1}).setView([56.010569,92.852572],7),this.appDark?this.mapTile=v.a.tileLayer.colorFilter("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',filter:this.mapFilter.dark}).addTo(this.map):this.mapTile=v.a.tileLayer.colorFilter("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',filter:this.mapFilter.light}).addTo(this.map),this.UI_selectUav(null,null),this.map.doubleClickZoom.disable(),this.map.on("contextmenu",this.handleAddMarker),this.map.on("viewreset",this.updateHubs()),this.map.on("dblclick",(function(){e.selected_id=0,e.UI_selectUav(null,null),e.map.removeLayer(e.UI.track.RoutePolyline),e.map.removeLayer(e.UI.track.PreRoutePolyline),e.map.removeLayer(e.UI.track.ApRoutePolyline),e.map.removeLayer(e.UI.addOrder.firstMarker),e.map.removeLayer(e.UI.addOrder.secondMarker),e.UI.uavInfo.ordersOnboard=[]})),this.init();var r=this.project([55.937325,92.7366]),a=this.project([55.921384,93.057621]);this.dist20kmProject=Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2)),console.log(this.dist20kmProject),this.map.createPane("track"),this.map.getPane("track").style.zIndex=400,setInterval(function(){this.getUavs()}.bind(this),this.interval),setInterval(function(){this.appLoaded||this.init()}.bind(this),1e3),setInterval(function(){this.appLoaded&&(this.statusBar.connectionSpeed=this.connectionSpeed,this.statusBar.totalUavs=this.totalStats.aircraftsInFlight,this.statusBar.totalOrders=this.totalStats.totalOrders)}.bind(this),1e3)},methods:{changeMapTheme:function(){this.map.removeLayer(this.mapTile),this.appDark?this.mapTile=v.a.tileLayer.colorFilter("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',filter:this.mapFilter.dark}).addTo(this.map):this.mapTile=v.a.tileLayer.colorFilter("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',filter:this.mapFilter.light}).addTo(this.map)},return_is_UI_AddOrder_Proc:function(){return!!this.UI.addOrder.processing},sendNewOrder:function(){var e=this;null!=this.UI.addOrder.firstMarker&&null!=this.UI.addOrder.secondMarker&&null!=this.UI.addOrder.orderWeight?(this.UI.addOrder.error=!1,this.UI.addOrder.sending=!0,this.UI.addOrder.firstMarker.dragging.disable(),this.UI.addOrder.secondMarker.dragging.disable(),I.a.post(this.apiServer.url+"orders/new",{weight:Number(this.UI.addOrder.orderWeight),first_lat:this.UI.addOrder.firstLatLng.lat,first_lon:this.UI.addOrder.firstLatLng.lng,last_lat:this.UI.addOrder.secondLatLng.lat,last_lon:this.UI.addOrder.secondLatLng.lng},{timeout:1e3,headers:{"Content-Type":"application/json",Accept:"*/*"}}).then((function(t){console.log(t.data),e.UI.addOrder.orderInfo=t.data,e.drawPreRoute(e.UI.addOrder.orderInfo),e.drawRoute(e.UI.addOrder.orderInfo.route),e.window=1,e.toggleDeliveryZone()})).catch((function(t){console.log("ERROR\n\n",t),e.UI.addOrder.sending=!1,e.UI.addOrder.error=!0,e.UI.addOrder.firstMarker.dragging.enable(),e.UI.addOrder.secondMarker.dragging.enable()})).finally((function(){e.UI.addOrder.sending=!1}))):console.log("neok")},resetOrder:function(){this.UI.addOrder.showMarkers=!1,this.deleteOrderMarkers()},drawRoute:function(e){var t=this;this.UI.track.RoutePoints=[],this.map.removeLayer(this.UI.track.RoutePolyline),this.UI.track.RoutePolyline=Object,e.forEach((function(e){t.UI.track.RoutePoints.push([180*e.lan_pos/Math.PI,180*e.lon_pos/Math.PI])})),this.UI.track.RoutePolyline=v.a.polyline(this.UI.track.RoutePoints,{color:"#00ffff",opacity:.5,pane:"track"}),this.UI.track.RoutePolyline.addTo(this.map)},drawPreRoute:function(e){this.UI.track.PreRoutePoints=[],this.UI.track.ApRoutePoints=[],this.map.removeLayer(this.UI.track.PreRoutePolyline),this.map.removeLayer(this.UI.track.ApRoutePolyline),this.UI.track.PreRoutePolyline=Object,this.UI.track.ApRoutePolyline=Object,this.UI.track.PreRoutePoints.push([e.first_lat,e.first_lon]),this.UI.track.PreRoutePoints.push([180*e.route[0].lan_pos/Math.PI,180*e.route[0].lon_pos/Math.PI]),this.UI.track.ApRoutePoints.push([e.last_lat,e.last_lon]),this.UI.track.ApRoutePoints.push([180*e.route[e.route.length-1].lan_pos/Math.PI,180*e.route[e.route.length-1].lon_pos/Math.PI]),this.UI.track.PreRoutePolyline=v.a.polyline(this.UI.track.PreRoutePoints,{color:"#ff00ff",opacity:.5,pane:"track"}),this.UI.track.PreRoutePolyline.addTo(this.map),this.UI.track.ApRoutePolyline=v.a.polyline(this.UI.track.ApRoutePoints,{color:"#ff00ff",opacity:.5,pane:"track"}),this.UI.track.ApRoutePolyline.addTo(this.map)},addOrderMarkers:function(){this.UI.addOrder.processing=!0,this.UI.addOrder.showMarkers=!0,this.UI.addOrder.locBtnText="Укажите точку отправления"},deleteOrderMarkers:function(){this.UI.addOrder.showMarkers||(null!=this.UI.addOrder.firstMarker&&(this.map.removeLayer(this.UI.addOrder.firstMarker),this.UI.addOrder.firstMarker=null),null!=this.UI.addOrder.secondMarker&&(this.map.removeLayer(this.UI.addOrder.secondMarker),this.UI.addOrder.secondMarker=null))},handleAddMarker:function(e){this.UI.addOrder.processing&&(this.UI.addOrder.firstProcessing=!this.UI.addOrder.firstProcessing,this.UI.addOrder.secondProcessing?(this.UI.addOrder.secondLatLng=e.latlng,this.UI.addOrder.secondMarker=new v.a.marker(e.latlng,{icon:this.UI.addOrder.secondIcon,draggable:!0}).addTo(this.map),this.UI.addOrder.secondMarker.bindTooltip("Конечная точка<br>"+this.UI.addOrder.secondLatLng.lat.toFixed(6)+", "+this.UI.addOrder.secondLatLng.lng.toFixed(6),{permanent:!0,direction:"right",className:"marker-tooltip"}),this.UI.addOrder.secondMarker.on("dragstart",this.freezeSecondMarkerTooltip),this.UI.addOrder.secondMarker.on("dragend",this.updateSecondMarkerCoords),this.UI.addOrder.secondProcessing=!1,this.UI.addOrder.firstProcessing=!1,this.UI.addOrder.processing=!1,this.UI.addOrder.processing=!1,this.UI.addOrder.locBtnText=this.UI.addOrder.locBtnTextDefault,this.UI.addOrder.arePointsAdded=!0,this.$refs.addOrder_Weight.focus()):this.UI.addOrder.firstProcessing&&(this.UI.addOrder.firstLatLng=e.latlng,this.UI.addOrder.firstMarker=new v.a.marker(e.latlng,{icon:this.UI.addOrder.firstIcon,draggable:!0}).addTo(this.map),this.UI.addOrder.firstMarker.bindTooltip("Начальная точка<br>"+this.UI.addOrder.firstLatLng.lat.toFixed(6)+", "+this.UI.addOrder.firstLatLng.lng.toFixed(6),{permanent:!0,direction:"right",className:"marker-tooltip"}),this.UI.addOrder.firstMarker.on("dragstart",this.freezeFirstMarkerTooltip),this.UI.addOrder.firstMarker.on("dragend",this.updateFirstMarkerCoords),this.UI.addOrder.firstProcessing=!1,this.UI.addOrder.secondProcessing=!0,this.UI.addOrder.locBtnText="Укажите точку прибытия"))},freezeFirstMarkerTooltip:function(){this.UI.addOrder.firstMarker.setTooltipContent("Начальная точка<br>...",{permanent:!0,direction:"centre",className:"marker-tooltip"})},updateFirstMarkerCoords:function(){this.UI.addOrder.firstLatLng=this.UI.addOrder.firstMarker.getLatLng(),this.UI.addOrder.firstMarker.setTooltipContent("Начальная точка<br>"+this.UI.addOrder.firstLatLng.lat.toFixed(6)+", "+this.UI.addOrder.firstLatLng.lng.toFixed(6),{permanent:!0,direction:"centre",className:"marker-tooltip"})},freezeSecondMarkerTooltip:function(){this.UI.addOrder.secondMarker.setTooltipContent("Конечная точка<br>...",{permanent:!0,direction:"centre",className:"marker-tooltip"})},updateSecondMarkerCoords:function(){this.UI.addOrder.secondLatLng=this.UI.addOrder.secondMarker.getLatLng(),this.UI.addOrder.secondMarker.setTooltipContent("Конечная точка<br>"+this.UI.addOrder.secondLatLng.lat.toFixed(6)+", "+this.UI.addOrder.secondLatLng.lng.toFixed(6),{permanent:!0,direction:"centre",className:"marker-tooltip"})},initPixiOverlay:function(){var e=this,t=new g["Container"],r=v.a.pixiOverlay((function(t){e.container=t.getContainer(),e.renderer=t.getRenderer(),e.project=t.latLngToLayerPoint,e.getScale=t.getScale}),t),a=new g["Loader"];a.add("marker1","drone-1.png").add("marker2","drone0.png").add("marker3","helicopter.png").add("marker4","aircraft.png").add("hub3","helipad_large.png").add("hub2","helipad_medium.png").add("hub1","helipad_small.png"),a.load((function(t,r){var a=0,i=function(){var t=new g["Sprite"](r.marker1.texture);t.x=0,t.y=0,t.anchor.set(.5,.5),t.interactive=!0,t.buttonMode=!0,t.on("pointerup",(function(){e.selected_id===t.zIndex?(e.selected_id=0,e.UI_deselectUav(t.zIndex,0)):(e.selected_id=t.zIndex,e.UI_selectUav(t.zIndex,0))})),e.MarkersArrays[0].push(t),a++};while(a<e.MarkersArrays_len[0])i();a=0;var n=function(){var t=new g["Sprite"](r.marker2.texture);t.x=0,t.y=0,t.anchor.set(.5,.5),t.interactive=!0,t.buttonMode=!0,t.on("pointerup",(function(){e.selected_id===t.zIndex?(e.selected_id=0,e.UI_deselectUav(t.zIndex,1)):(e.selected_id=t.zIndex,e.UI_selectUav(t.zIndex,1))})),e.MarkersArrays[1].push(t),a++};while(a<e.MarkersArrays_len[1])n();a=0;var o=function(){var t=new g["Sprite"](r.marker3.texture);t.x=0,t.y=0,t.anchor.set(.5,.5),t.interactive=!0,t.buttonMode=!0,t.on("pointerup",(function(){e.selected_id===t.zIndex?(e.selected_id=0,e.UI_deselectUav(t.zIndex,2)):(e.selected_id=t.zIndex,e.UI_selectUav(t.zIndex,2))})),e.MarkersArrays[2].push(t),a++};while(a<e.MarkersArrays_len[2])o();a=0;var s=function(){var t=new g["Sprite"](r.marker4.texture);t.x=0,t.y=0,t.anchor.set(.5,.5),t.interactive=!0,t.buttonMode=!0,t.on("pointerup",(function(){e.selected_id===t.zIndex?(e.selected_id=0,e.UI_deselectUav(t.zIndex,3)):(e.selected_id=t.zIndex,e.UI_selectUav(t.zIndex,3))})),e.MarkersArrays[3].push(t),a++};while(a<e.MarkersArrays_len[3])s();e.HubsFromApi.small.forEach((function(t){var a=new g["Sprite"](r.hub1.texture),i=e.project([180*t.Latitude/Math.PI,180*t.Longitude/Math.PI]);a.x=i.x,a.y=i.y,a.anchor.set(.5,.5),a.scale.set(1/30),a.interactive=!0,a.buttonMode=!0,a.zIndex=t.Id,a.isClicked=!1;var n=new g["Graphics"];n.beginFill(4360181,.1),console.log(e.dist20kmProject),n.lineStyle(1,4360181,1),n.drawCircle(i.x,i.y,e.dist20kmProject),n.endFill(),n.zIndex=0,a.on("pointerup",(function(){a.isClicked?(a.isClicked=!1,e.container.removeChild(n)):(a.isClicked=!0,e.container.addChild(n))})),e.container.addChild(a),t["marker"]=a,t["circle"]=n})),e.HubsFromApi.medium.forEach((function(t){var a=new g["Sprite"](r.hub2.texture),i=e.project([180*t.Latitude/Math.PI,180*t.Longitude/Math.PI]);a.x=i.x,a.y=i.y,a.anchor.set(.5,.5),a.scale.set(.04),a.interactive=!0,a.buttonMode=!0,a.zIndex=t.Id,a.isClicked=!1;var n=new g["Graphics"];n.beginFill(14429951,.1),console.log(e.dist20kmProject),n.lineStyle(1,14429951,1),n.drawCircle(i.x,i.y,e.dist20kmProject),n.endFill(),n.zIndex=0,a.on("pointerup",(function(){a.isClicked?(a.isClicked=!1,e.container.removeChild(n)):(a.isClicked=!0,e.container.addChild(n))})),e.container.addChild(a),t["marker"]=a,t["circle"]=n})),e.HubsFromApi.large.forEach((function(t){var a=new g["Sprite"](r.hub3.texture),i=e.project([180*t.Latitude/Math.PI,180*t.Longitude/Math.PI]);a.x=i.x,a.y=i.y,a.anchor.set(.5,.5),a.scale.set(.05),a.interactive=!0,a.buttonMode=!0,a.zIndex=t.Id,a.isClicked=!1;var n=new g["Graphics"];n.beginFill(3080107,.1),console.log(e.dist20kmProject),n.lineStyle(1,3080107,1),n.drawCircle(i.x,i.y,e.dist20kmProject),n.endFill(),n.zIndex=0,a.on("pointerup",(function(){a.isClicked?(a.isClicked=!1,e.container.removeChild(n)):(a.isClicked=!0,e.container.addChild(n))})),e.container.addChild(a),t["marker"]=a,t["circle"]=n}))})),r.addTo(this.map)},getUavs:function(){var e=this,t=new Date;I.a.get(this.apiServer.url+"state/binary",{timeout:2e3,headers:{},responseType:"arraybuffer"}).then((function(r){var a=new Date;e.connectionSpeed=a-t,e.aircraftFromApi.raw=r.data,e.updateUavs(),e.appLoaded=!0})).catch((function(t){console.log(t),e.connectionSpeed=">2000"})).finally((function(){return e.loading=!1}))},updateUavs:function(){var e,t,r,a,i,n,o,s=this.map.getZoom(),d=new DataView(this.aircraftFromApi.raw),l=d.getInt32(0,!0),c=[0,0,0,0],u=4,p=1/this.getScale(s),h=0;0==this.window&&(l=0);while(u<l+4)e=d.getBigInt64(u,!0),t=d.getInt32(u+8,!0)+1,-1===t&&(t=0),r=d.getFloat32(u+12,!0),a=d.getFloat32(u+16,!0),i=d.getFloat32(u+20,!0),h+=d.getInt32(u+24,!0),n=this.MarkersArrays[t][c[t]],this.container.addChild(n),o=this.project([a,r]),n.x=o.x,n.y=o.y,n.angle=i,n.zIndex=e,e===this.selected_id?n.scale.set(p):s>=9?n.scale.set(p/2.5):n.scale.set(.5),c[t]++,u+=28;this.totalStats.aircraftsInFlight=c[0]+c[1]+c[2]+c[3],this.totalStats.totalOrders=h,this.renderer.render(this.container);for(var f=0;f<4;f++)for(var v=c[f];v<this.prev_counters[f];v++)n=this.MarkersArrays[f][v],this.container.removeChild(n);this.prev_counters=c},init:function(){var e=this;I.a.get(this.apiServer.url+"hubs/all",{timeout:2e3,headers:{}}).then((function(t){var r=t.data;r.forEach((function(t){"0"==t.TypeHub?e.HubsFromApi.small.push(t):"1"==t.TypeHub?e.HubsFromApi.medium.push(t):"2"==t.TypeHub?e.HubsFromApi.large.push(t):console.log("error on parsing hubs: invalid type "+t)})),e.updateHubs(),e.appLoaded=!0})).catch((function(e){console.log(e)})).finally((function(){return e.loading=!1}))},updateHubs:function(){this.initPixiOverlay()},UI_selectUav:function(e,t){var r,a=this;try{this.map.removeLayer(this.UI.track.RoutePolyline),this.map.removeLayer(this.UI.track.PreRoutePolyline),this.map.removeLayer(this.UI.track.ApRoutePolyline),this.map.removeLayer(this.UI.addOrder.firstMarker),this.map.removeLayer(this.UI.addOrder.secondMarker)}catch(i){console.log(i)}if(null==e)return this.UI.uavInfo.type="Нет информации",this.UI.uavInfo.image="",void(this.UI.uavInfo.id="");this.UI.uavInfo.id=e,0==t?(this.UI.uavInfo.type="БпЛА для доставки на последней миле",this.UI.uavInfo.image="drone-1.png"):1==t?(this.UI.uavInfo.type="Малый БпЛА",this.UI.uavInfo.image="drone0.png"):2==t?(this.UI.uavInfo.type="Беспилотный вертолет",this.UI.uavInfo.image="helicopter.png"):3==t&&(this.UI.uavInfo.type="Грузовой самолет",this.UI.uavInfo.image="aircraft.png"),I.a.get(this.apiServer.url+"orders/getOrders",{timeout:2e3,headers:{},responseType:"json",params:{id:e}}).then((function(e){r=e.data})).catch((function(e){console.log(e)})).finally((function(){a.loading=!1,console.log(r),a.UI.uavInfo.ordersOnboard=r}))},UI_deselectUav:function(e,t){this.UI.uavInfo.type="Нет информации",this.UI.uavInfo.image="",this.UI.uavInfo.id="",this.UI.uavInfo.ordersOnboard=[],console.log("deselected",e,t)},disableMap:function(){this.map.dragging.disable(),this.map.touchZoom.disable(),this.map.doubleClickZoom.disable(),this.map.scrollWheelZoom.disable(),this.map.boxZoom.disable(),this.map.keyboard.disable(),this.map.tap&&this.map.tap.disable(),document.getElementById("uavKarta").style.cursor="default"},enableMap:function(){this.map.dragging.enable(),this.map.touchZoom.enable(),this.map.doubleClickZoom.enable(),this.map.scrollWheelZoom.enable(),this.map.boxZoom.enable(),this.map.keyboard.enable(),this.map.tap&&this.map.tap.enable(),document.getElementById("uavKarta").style.cursor="grab"},resetAddOrder:function(){0==this.window&&(this.map.removeLayer(this.UI.track.RoutePolyline),this.map.removeLayer(this.UI.track.PreRoutePolyline),this.map.removeLayer(this.UI.track.ApRoutePolyline),this.map.removeLayer(this.UI.addOrder.firstMarker),this.map.removeLayer(this.UI.addOrder.secondMarker),this.UI.addOrder.firstMarker=null,this.UI.addOrder.firstLatLng=null,this.UI.addOrder.secondMarker=null,this.UI.addOrder.secondLatLng=null,this.UI.addOrder.orderWeight=null,this.UI.addOrder.error=!1,this.UI.addOrder.showMarkers=!1,this.UI.addOrder.processing=!1,this.UI.addOrder.locBtnText="Откуда, куда",this.UI.addOrder.locBtnTextDefault="Откуда, куда",this.UI.addOrder.sending=!1,this.UI.addOrder.arePointsAdded=!1,this.UI.addOrder.orderInfo={})},toggleDeliveryZone:function(){var e=this;this.HubsFromApi.small.forEach((function(t){0==e.window?e.container.addChild(t.circle):e.container.removeChild(t.circle)})),this.HubsFromApi.medium.forEach((function(t){0==e.window?e.container.addChild(t.circle):e.container.removeChild(t.circle)})),this.HubsFromApi.large.forEach((function(t){0==e.window?e.container.addChild(t.circle):e.container.removeChild(t.circle)}))},sendTrackOrder:function(e){var t=this;null!=e&&I.a.get(this.apiServer.url+"orders/getOrderInfo",{params:{id:e},timeout:2e3}).then((function(e){console.log(e.data),t.UI.addOrder.orderInfo=e.data,t.UI.track.result=!0,t.drawPreRoute(t.UI.addOrder.orderInfo),t.drawRoute(t.UI.addOrder.orderInfo.route),t.window=1,t.toggleDeliveryZone()})).catch((function(e){console.log("ERROR\n\n",e),t.UI.track.result=!1,t.map.removeLayer(t.UI.track.RoutePolyline),t.map.removeLayer(t.UI.track.PreRoutePolyline),t.map.removeLayer(t.UI.track.ApRoutePolyline),t.map.removeLayer(t.UI.addOrder.firstMarker),t.map.removeLayer(t.UI.addOrder.secondMarker)})).finally((function(){}))}}},P=x,M=(r("5490"),Object(_["a"])(P,p,h,!1,null,null,null)),L=M.exports,C={name:"App",components:{Map:L}},S=C,A=(r("034f"),Object(_["a"])(S,c,u,!1,null,null,null)),R=A.exports;a["default"].config.productionTip=!1,a["default"].use(d.a),a["default"].use(l["a"]),new a["default"]({vuetify:o,render:function(e){return e(R)},loader:l["a"]}).$mount("#app")},"85ec":function(e,t,r){},"8f6b":function(e,t,r){},a6b6:function(e,t,r){}});
//# sourceMappingURL=app.751adc87.js.map